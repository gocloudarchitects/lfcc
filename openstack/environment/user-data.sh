#!/bin/bash

###
#### This is an insecure example, not for production.
###

# Disable the firewall - cloud environments often prefer to implement
# security through centrally managed ACLs
ufw disable

# Place the private key 
cat << EOF > /home/ubuntu/.ssh/id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----
EOF

# Add public key to authorized keys
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDg3TTU+cl3X8V1x8bF54mMnxinqJQDKD8VsUxrm2WpY4OgLDnGZXdZkvdnlgSuoxVkPphmdXq4Hd7kEz25xJ9MVc6QkQbQUKAFxcowQ6gkAPQXe+t1fl81rhxb1rrWstyEw8tYWu1snFFLsmCs7HtQeZgCWOF2l6mk5knYsG2EM01GQydQq77ZVz+8Zaip+qt0VCYr1+u9xPotM3UU6ulgXlzpFbX027/r3f8e0SP23dNDIzu9J3vA68nO96QC3pa34K7qncK5NgzkFl9LPQbOPuOGadTv+sr3yiGhBaVLAj32zkS912c0+My2mvVb8sWzvtXkz/igAh+AcKlyIKfpHOD2QqaCxCMErJVGQiSAZBShGqcwbBXtr+oLO35OkejsgbpcDC9CZBYyL7LaHUujNmpcnR6usm6dqsV7NWqr7deaoO2HZzvzBbJ/6GtC1da9lp3G1FtFbJtuG5kMhOKmaqSlKlK+OLb3H9F0tA2yPeEl5amAYue0Y7rF9XODB1M=" >> /home/ubuntu/.ssh/authorized_keys

# Ensure the permissions are correct
chmod 600 /home/ubuntu/.ssh/{authorized_keys,id_rsa}
chown ubuntu.ubuntu /home/ubuntu/.ssh/*

